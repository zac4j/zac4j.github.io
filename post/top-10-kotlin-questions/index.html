<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    
    <title>Top 10 Kotlin Questions in StackOverflow | Zac&#39;s Blog</title>
    <meta name="description" content="Android developer blog">
    <meta name="author" content="">
    
    <link rel="apple-touch-icon" sizes="180x180" href=https://zacash.cn/apple-touch-icon.png>
    <link rel="icon" type="image/png" sizes="32x32" href=https://zacash.cn/favicon-32x32.png>
    <link rel="icon" type="image/png" sizes="16x16" href=https://zacash.cn/favicon-16x16.png>
    <link rel="manifest" href=https://zacash.cn/site.webmanifest>
    <link rel="mask-icon" href=https://zacash.cn/safari-pinned-tab.svg color="#00416a">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="me" href="mailto:zac_ju@163.com">
    <link rel="me" href="https://github.com/zac4j">
    
    
    
    <link rel="authorization_endpoint" href=https://indieauth.com/auth />
    <link rel="token_endpoint" href=https://tokens.indieauth.com/token />
    
    
    
    
    
    <link rel="stylesheet" href=https://zacash.cn/css/fonts.css />
    <link rel="stylesheet" href=https://zacash.cn/css/style.css />
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <div id="sitelogo">
        <a class="glyph" alt="Home" href="https://zacash.cn"><img src=https://zacash.cn/images/site-logo.svg alt="Site Logo" height="64px" width="64px"></a>
    </div>
    <header>
        <nav>
    
    <div id="page-nav">
        <div class="page-nav-item">
            <a href="https://zacash.cn">Home</a>
        </div>
        
    </div>
</nav>
        
    </header>




<div id="content">
    <article class="h-entry">
        <header>
            <h1 class="post-title p-name">Top 10 Kotlin Questions in StackOverflow</h1>
            
            <p class="post-date">Posted on
                <time class="dt-published" datetime="2020-06-19T22:03:29&#43;08:00">
                    19 June, 2020 at 22:03 CST
                </time>  by <a href="https://zacash.cn" class="p-author h-card"
                    rel="author">Zac</a>
            </p>
            
            
            <p class="post-tag">Category:
                
                <a href="https://zacash.cn/categories/kotlin" class="post-tag p-category">kotlin</a>
                
            </p>
            <hr class="post-underline">
            
        </header>
        <section class="content e-content">
            <h4 id="intarray-vs-arrayint">IntArray vs. <code>Array&lt;Int&gt;</code></h4>
<ul>
<li>
<p>In java code</p>
<ul>
<li>IntArray: int[]</li>
<li><code>Array&lt;Int&gt;</code>: Integer[]</li>
</ul>
</li>
<li>
<p>Create method:</p>
<ul>
<li>IntArray:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">val</span> intArray : IntArray = intArrayOf(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>)
</code></pre></div><ul>
<li><code>Array&lt;Int&gt;</code>:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">val</span> arrayOfInts : Array&lt;Int&gt; = arrayOf(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>)
</code></pre></div></li>
</ul>
<h4 id="iterable-vs-sequence">Iterable vs. Sequence</h4>
<ul>
<li>
<p>Usage</p>
<ul>
<li>Iterable:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt">getPeople()
.filter { it.age &gt;= <span style="color:#ae81ff">18</span> }
.map { it.name }
.take(<span style="color:#ae81ff">5</span>)
</code></pre></div><ul>
<li>Sequence: start with <code>asSequence()</code> and end with <code>toList()</code> or <code>toSet()</code>&hellip;</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt">getPeople().asSequence()
.filter { it.age &gt;= <span style="color:#ae81ff">18</span> }
.map { it.name }
.take(<span style="color:#ae81ff">5</span>)
.toList()
</code></pre></div></li>
<li>
<p>Use for</p>
<ul>
<li>Iterable: use for small collections by default, might faster than the overhead using a <code>Sequence</code></li>
<li>Sequence: use for <code>very large</code> collections.</li>
</ul>
</li>
</ul>
<h4 id="iterate-a-collection">Iterate a collection</h4>
<ul>
<li>
<p>eg.1</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">for</span>(i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">0.</span>.args.size - <span style="color:#ae81ff">1</span>) {
    println(args[i])
}
</code></pre></div></li>
<li>
<p>eg.2, use Array&rsquo;s <code>lastIndex</code> extension property.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">for</span>(i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">0.</span>.args.lastIndex) {
    println(args[i])
}
</code></pre></div></li>
<li>
<p>eg., use <code>until</code> to create open ended range.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">for</span>(i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">0</span> until args.size) {
    println(args[i])
}
</code></pre></div></li>
<li>
<p>eg.4, use <code>indices</code> extension property.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">for</span>(i <span style="color:#66d9ef">in</span> args.indices) {
    println(args[i])
}
</code></pre></div></li>
<li>
<p>eg.5</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">for</span> (arg <span style="color:#66d9ef">in</span> args) {
    println(arg)
}
</code></pre></div></li>
<li>
<p>eg.6, use <code>forEach</code> extension function.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt">args.forEach { arg -&gt;
    println(arg)
}
</code></pre></div></li>
<li>
<p>eg.7, use <code>withIndex</code> function.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">for</span>((index, arg) <span style="color:#66d9ef">in</span> args.withIndex()) {
    println(<span style="color:#e6db74">&#34;index: $index, arg: $arg&#34;</span>)
}
</code></pre></div></li>
<li>
<p>eg.8, use <code>forEachIndexed</code> functions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt">args.forEachIndexed { index, arg -&gt;
    println(<span style="color:#e6db74">&#34;index: $index, arg: $arg&#34;</span>)
}
</code></pre></div></li>
</ul>
<h4 id="sam-conversion">SAM conversion</h4>
<blockquote>
<p>SAM conversions only work for interfaces, not for abstract classes</p>
</blockquote>
<ul>
<li>
<p>This code will work fine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt">button.setListener {
    println(<span style="color:#e6db74">&#34;Clicked!&#34;</span>)
}
</code></pre></div></li>
<li>
<p>The following will not work:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#75715e">/**
</span><span style="color:#75715e">* This gives the button a lambda that will create an anonymous instance of an OnClickListener
</span><span style="color:#75715e">* every time the button is clicked, which is then just thrown away (never assigned anywhere,
</span><span style="color:#75715e">* never invoked).
</span><span style="color:#75715e">*/</span>
button.setListener {
    <span style="color:#66d9ef">object</span>: OnClickListener {
        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onClick</span>(button: Button) {
            println(<span style="color:#e6db74">&#34;Clicked!&#34;</span>)
        }
    }
}

<span style="color:#75715e">/**
</span><span style="color:#75715e">* This one declares a useless local function in a very simliar fashion
</span><span style="color:#75715e">*/</span>
button.setListener {
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onClick</span>(button: Button) {
        println(<span style="color:#e6db74">&#34;Clicked!&#34;</span>)
    }
}
</code></pre></div></li>
<li>
<p><a href="https://stackoverflow.com/questions/48284994/lambda-implementation-of-interface-in-kotlin">SAM constructor</a></p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * If the interface is defined in Java, but the function that takes an instance of its defined in Kotlin,
</span><span style="color:#75715e"> * try to use a SAM constructor.
</span><span style="color:#75715e"> */</span>
 button.setListener(OnClickListener {
    println(<span style="color:#e6db74">&#34;Clicked&#34;</span>)
 })
</code></pre></div><ul>
<li>Explanation
|               | Java interface  | Kotlin interface  |
|&mdash;&mdash;&mdash;&mdash;&mdash;|&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-|
| Java method   | SAM conversion  | Object expression |
| Kotlin method | SAM constructor | Object expression |</li>
</ul>
<h4 id="static-things">Static things</h4>
<ul>
<li>
<p>If your class has &ldquo;non-static&rdquo; parts as well, put the &ldquo;static&rdquo; parts in a companion object:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Foo</span> {
    <span style="color:#66d9ef">companion</span> <span style="color:#66d9ef">object</span> {
        <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">x</span>() {...}
    }
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">y</span>() {...}
}
</code></pre></div></li>
<li>
<p>If your class is completely static, replace <code>class</code> with a singleton <code>object</code> :</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Foo</span> {
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">x</span>() {...}
}
</code></pre></div><ul>
<li>And if you don&rsquo;t want to always scope your calls as <code>Foo.x()</code> but want to just use <code>x()</code> instead, use a top level function:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#75715e">// file Foo.kt
</span><span style="color:#75715e"></span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">x</span>() {...}
</code></pre></div><ul>
<li>For function, there has this table:
| Function declaration             | Kotlin usage | Java usage         |
|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-|&mdash;&mdash;&mdash;&mdash;&ndash;|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;|
| Companion object                 | Foo.f()      | Foo.Companion.f(); |
| Companion object with @JvmStatic | Foo.f()      | Foo.f();           |
| Object                           | Foo.f()      | Foo.INSTANCE.f();  |
| Object with @JvmStatic           | Foo.f()      | Foo.f();           |
| Top level function               | f()          | UtilKt.f();        |
| Top level function with @JvmName | f()          | Util.f();          |</li>
<li>For variable, here&rsquo;s the reference:
| Variable declaration                           | Kotlin usage | Java usage          |
|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;|&mdash;&mdash;&mdash;&mdash;&ndash;|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;|
| Companion object                               | X.x          | X.Companion.getX(); |
| Companion object with @JvmStatic               | X.x          | X.getX();           |
| Companion object with @JvmField                | X.x          | X.x;                |
| Companion object with const                    | X.x          | X.x();              |
| Object                                         | X.x          | X.INSTANCE.getX();  |
| Object with @JvmStatic                         | X.x          | X.getX();           |
| Object with @JvmField                          | X.x          | X.x;                |
| Object with const                              | X.x          | X.x;                |
| Top level variable                             | x            | ConstKt.getX();     |
| Top level variable with @JvmField              | x            | ConstKt.x;          |
| Top level variable with const                  | x            | ConstKt.x;          |
| Top level variable with @JvmName               | x            | Const.getX();       |
| Top level variable with @JvmName and @JvmField | x            | Const.x;            |
| Top level variable with @JvmName and const     | x            | Const.x;            |</li>
</ul>
<h4 id="6smart-cast-on-mutable-properties">6.Smart cast on mutable properties</h4>
<p>以下代码会报这种错：</p>
<blockquote>
<p>Kotlin: Smart cast to &lsquo;Toy&rsquo; is impossible, because &lsquo;toy&rsquo; is a mutable property that could have been changed by this time</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Dog</span>(<span style="color:#66d9ef">var</span> toy: Toy? = <span style="color:#66d9ef">null</span>) {
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">play</span>() {
        <span style="color:#66d9ef">if</span> (toy != <span style="color:#66d9ef">null</span>) {
            toy.chew()
        }
    }
}
</code></pre></div><p>原因：
因为 mutable 的变量<code>Dog</code> 实例可能在<code>toy!=null</code>检查后在另一条线程上被修改，而在 <code>toy.chew()</code>执行时可能产生 NPE.</p>
<p>可以做以下修改：</p>
<ul>
<li>使用局部变量</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Dog</span>(<span style="color:#66d9ef">var</span> toy: Toy? = <span style="color:#66d9ef">null</span>) {
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">play</span>() {
        <span style="color:#66d9ef">val</span> _toy = toy
        <span style="color:#66d9ef">if</span> (_toy != <span style="color:#66d9ef">null</span>) {
            _toy.chew()
        }
    }
}
</code></pre></div><ul>
<li>临时 let 操作符，使用范围更广泛：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Dog</span>(<span style="color:#66d9ef">var</span> toy: Toy? = <span style="color:#66d9ef">null</span>) {
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">play</span>() {
        toy<span style="color:#f92672">?.</span>let {
            it.chew()
        }
    }
}
</code></pre></div><ul>
<li>?. 操作符</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Dog</span>(<span style="color:#66d9ef">var</span> toy: Toy? = <span style="color:#66d9ef">null</span>) {
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">play</span>() {
        toy<span style="color:#f92672">?.</span>chew()
    }
}
</code></pre></div><h4 id="override-java-方法">override Java 方法</h4>
<p>假设 Java 中定义了接口 <code>OnClickListener</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">OnClickListener</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">(</span>Button button<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>在 Kotlin 中实现该接口，如果使用IDEA生成：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KtListener</span>: OnClickListener {
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onClick</span>(button: Button?): Unit {
        <span style="color:#66d9ef">val</span> name = button<span style="color:#f92672">?.</span>name <span style="color:#f92672">?:</span> <span style="color:#e6db74">&#34;Unknown button&#34;</span>
        println(<span style="color:#e6db74">&#34;Clicked $name&#34;</span>)
    }
}
</code></pre></div><p>对于我们知道不可能为 <code>null</code> 的场景，可以这样写：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KtListener</span>: OnClickListener {
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onClick</span>(button: Button): Unit {
        <span style="color:#66d9ef">val</span> name = button.name
        println(<span style="color:#e6db74">&#34;Clicked $name&#34;</span>)
    }
}
</code></pre></div>
        </section>
        <footer>
            <a class="permalink u-url" href="https://zacash.cn/post/top-10-kotlin-questions/">🔗</a>
            
            <hr class="post-underline">
            <p class="post-tag">Tags for this post:
                
                <a href="https://zacash.cn/tags/kotlin" class="post-tag p-category">kotlin</a>
                
            </p>
            
        </footer>
    </article>
</div>

    
    <div class="h-card">
      <img class="u-photo" src="https://zacash.cn/images/android-os.png" />
      <div class="card-content">
        <h2 class="card-name"><a class="p-name u-url" href="https://zacash.cn" rel="me">Zac</a></h2>
        <p class="card-subhead">
          <span class="p-locality">Shanghai</span>,
          <span class="p-country-name">China</span><br />
          <a class="u-email" href="mailto:zac_ju@163.com">Email me</a>
        </p>
      </div>
      <p class="p-note">🐭</p>
    </div>
    
    <div id="footer">
      
      <nav id="article-skip">
        <div class="next">
          
          <a alt="Newer article" href="https://zacash.cn/post/java-basic/">&larr; Newer</a>
          
        </div>
        <div class="top">
          <a alt="Top of page" href="#">Top</a>
        </div>
        <div class="prev">
          
          <a alt="Older article" href="https://zacash.cn/post/intro-to-build-system/">Older &rarr;</a>
          
        </div>
      </nav>
      
      <aside id="social">
  <div id="social-icons">
    
    
    
    
    <div class="icon-24x24">
      <a class="glyph" alt="GitHub profile" href="https://github.com/zac4j"><img src=https://zacash.cn/icons/github.svg height="24px" width="24px"></a>
    </div>
    
    
    
    
    
    
    
    
    
    
    
    
  </div>
</aside>

      
      <p class="copyright">
          Copyright © 2020, Copyright Zac
      </p>
      
    </div>


</body>
</html>