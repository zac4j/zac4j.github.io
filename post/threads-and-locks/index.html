<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    
    <title>Threads and Locks | Zac&#39;s Blog</title>
    <meta name="description" content="Threads and locks">
    <meta name="author" content="">
    
    <link rel="apple-touch-icon" sizes="180x180" href=https://zacash.cn/apple-touch-icon.png>
    <link rel="icon" type="image/png" sizes="32x32" href=https://zacash.cn/favicon-32x32.png>
    <link rel="icon" type="image/png" sizes="16x16" href=https://zacash.cn/favicon-16x16.png>
    <link rel="manifest" href=https://zacash.cn/site.webmanifest>
    <link rel="mask-icon" href=https://zacash.cn/safari-pinned-tab.svg color="#00416a">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="me" href="mailto:zac_ju@163.com">
    <link rel="me" href="https://github.com/zac4j">
    
    
    
    <link rel="authorization_endpoint" href=https://indieauth.com/auth />
    <link rel="token_endpoint" href=https://tokens.indieauth.com/token />
    
    
    
    
    
    <link rel="stylesheet" href=https://zacash.cn/css/fonts.css />
    <link rel="stylesheet" href=https://zacash.cn/css/style.css />
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <div id="sitelogo">
        <a class="glyph" alt="Home" href="https://zacash.cn"><img src=https://zacash.cn/images/site-logo.svg alt="Site Logo" height="64px" width="64px"></a>
    </div>
    <header>
        <nav>
    
    <div id="page-nav">
        <div class="page-nav-item">
            <a href="https://zacash.cn">Home</a>
        </div>
        
    </div>
</nav>
        
    </header>




<div id="content">
    <article class="h-entry">
        <header>
            <h1 class="post-title p-name">Threads and Locks</h1>
            
            <p class="post-date">Posted on
                <time class="dt-published" datetime="2020-07-27T00:00:00Z">
                    27 July, 2020 at 00:00 UTC
                </time>  by <a href="https://zacash.cn" class="p-author h-card"
                    rel="author">Zac</a>
            </p>
            
            
            <p class="post-tag">Category:
                
                <a href="https://zacash.cn/categories/thread" class="post-tag p-category">thread</a>
                
                <a href="https://zacash.cn/categories/lock" class="post-tag p-category">lock</a>
                
            </p>
            <hr class="post-underline">
            
        </header>
        <section class="content e-content">
            <p>Threads are created and managed by the classes Thread and ThreadGroup. Creating a Thread object creates a thread, and that is the only way to create a thread. When the thread is created, it is not yet active; it begins to run when its start method is called.</p>
<h2 id="813-locks-and-synchronization">8.13 Locks and Synchronization</h2>
<p>There is a lock associated with every object. The Java programming language does not provide a way to perform separate lock and unlock operations; instead, they are implicitly performed by high-level constructs that always arrange to pair such operations correctly. (The Java virtual machine, however, provides separate monitorenter and monitorexit instructions that implement the lock and unlock operations.)</p>
<p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªé”ã€‚Java æ²¡æœ‰å•ç‹¬æä¾›é”å®šå’Œè§£é”çš„æ–¹æ³•ï¼›ç›¸åå®ƒä»¬ç”±å§‹ç»ˆå®‰æ’å‡†ç¡®é…å¯¹æ“ä½œçš„é«˜é˜¶æ„é€ éšå¼æ‰§è¡Œã€‚Jvm æä¾›äº†å•ç‹¬çš„ <em>monitorenter</em> å’Œ <em>monitorexit</em> æŒ‡ä»¤ï¼Œç”¨äºå®ç°é”å®šå’Œè§£é”æ“ä½œã€‚</p>
<p>The synchronized statement computes a reference to an object; it then attempts to perform a lock operation on that object and does not proceed further until the lock operation has successfully completed. (A lock operation may be delayed because the rules about locks can prevent the main memory from participating until some other thread is ready to perform one or more unlock operations.) After the lock operation has been performed, the body of the synchronized statement is executed. Normally, a compiler for the Java programming language ensures that the lock operation implemented by a monitorenter instruction executed prior to the execution of the body of the synchronized statement is matched by an unlock operation implemented by a monitorexit instruction whenever the synchronized statement completes, whether completion is normal or abrupt.</p>
<p>åŒæ­¥è¯­å¥è®¡ç®—å¯¹è±¡çš„å¼•ç”¨ï¼Œå®ƒå°è¯•å¯¹è¯¥å¯¹è±¡æ‰§è¡Œé”å®šæ“ä½œï¼Œå¹¶ä¸”åœ¨é”å®šæ“ä½œå®Œæˆå‰ä¸ä¼šè¿›ä¸€æ­¥çš„æ“ä½œã€‚ï¼ˆé”å®šæ“ä½œå¯èƒ½å»¶è¿Ÿï¼Œå› ä¸ºæœ‰å…³é”å®šçš„è§„åˆ™å¯èƒ½é˜»æ­¢ä¸»å†…å­˜å‚ä¸ï¼Œç›´åˆ°çº¿ç¨‹å‡†å¤‡ä¸€ä¸ªæˆ–å¤šä¸ªè§£é”æ“ä½œä¸ºæ­¢ã€‚ï¼‰æŒ‡å®šé”å®šæ“ä½œåï¼Œå°†æ‰§è¡ŒåŒæ­¥è¯­å¥çš„ä¸»ä½“ã€‚é€šå¸¸ï¼ŒJava ç¼–è¯‘å™¨å¯ä»¥ç¡®ä¿ï¼Œç”± <em>monitorenter</em> æŒ‡ä»¤ï¼ˆåœ¨æ‰§è¡ŒåŒæ­¥è¯­å¥çš„ä¸»ä½“ä¹‹å‰æ‰§è¡Œï¼‰å®ç°çš„é”å®šæ“ä½œå’Œç”± <em>monitorexit</em> æŒ‡ä»¤å®ç°çš„è§£é”æ“ä½œç›¸åŒ¹é…ï¼Œè€Œä¸ç®¡åŒæ­¥è¯­å¥æ˜¯å¦æ‰§è¡Œå®Œæˆæˆ–æ‰“æ–­ã€‚</p>
<p>A synchronized method automatically performs a lock operation when it is invoked; its body is not executed until the lock operation has successfully completed. If the method is an instance method, it locks the lock associated with the instance for which it was invoked (that is, the object that will be known as this during execution of the method&rsquo;s body). If the method is static, it locks the lock associated with the Class object that represents the class in which the method is defined. If execution of the method&rsquo;s body is ever completed, either normally or abruptly, an unlock operation is automatically performed on that same lock.</p>
<p>åŒæ­¥æ–¹æ³•åœ¨è¢«è°ƒç”¨æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œé”å®šæ“ä½œã€‚åœ¨é”å®šæ“ä½œå®Œæˆå‰ä¸ä¼šæ‰§è¡Œæ–¹æ³•ä¸»ä½“ã€‚å¦‚æœè¯¥æ–¹æ³•æ˜¯å®ä¾‹æ–¹æ³•ï¼Œåˆ™å®ƒå°†ä¸è°ƒç”¨è¯¥æ–¹æ³•çš„å®ä¾‹é”å®šã€‚å¦‚æœè¯¥æ–¹æ³•æ˜¯é™æ€çš„ï¼Œåˆ™å®ƒå°†ä¸å®šä¹‰è¯¥æ–¹æ³•çš„ Class å¯¹è±¡ç›¸å…³è”çš„ç±»é”å®šã€‚å¦‚æœæ–¹æ³•ä¸»ä½“æ­£å¸¸æ‰§è¡Œæˆ–çªç„¶ä¸­æ–­ï¼Œåˆ™ä¸è¯¥é”é…å¯¹è§£é”æ“ä½œå°†è‡ªåŠ¨æ‰§è¡Œã€‚</p>
<p>Best practice is that if a variable is ever to be assigned by one thread and used or assigned by another, then all accesses to that variable should be enclosed in synchronized methods or synchronized statements.</p>
<p>æœ€ä½³å®è·µæ˜¯å¯¹äºæŸä¸ªå˜é‡ç”±ä¸€ä¸ªçº¿ç¨‹ <em>assign</em> å¹¶ç”±å¦ä¸€ä¸ªçº¿ç¨‹ <em>use</em> æˆ– <em>assign</em>ï¼Œåˆ™å¯¹è¯¥å˜é‡çš„æ‰€æœ‰è®¿é—®éƒ½åº”è¯¥æ”¾åœ¨ <em>synchronized</em> æ–¹æ³•æˆ– <em>synchronized</em> è¯­å¥ä¸­ã€‚</p>
<p>Although a compiler for the Java programming language normally guarantees structured use of locks (see Section 7.14, &ldquo;Synchronization&rdquo;), there is no assurance that all code submitted to the Java virtual machine will obey this property. Implementations of the Java virtual machine are permitted but not required to enforce both of the following two rules guaranteeing structured locking.</p>
<p>Let T be a thread and L be a lock. Then:</p>
<p>The number of lock operations performed by T on L during a method invocation must equal the number of unlock operations performed by T on L during the method invocation whether the method invocation completes normally or abruptly.</p>
<p>At no point during a method invocation may the number of unlock operations performed by T on L since the method invocation exceed the number of lock operations performed by T on L since the method invocation.
In less formal terms, during a method invocation every unlock operation on L must match some preceding lock operation on L.
Note that the locking and unlocking automatically performed by the Java virtual machine when invoking a synchronized method are considered to occur during the calling method&rsquo;s invocation.</p>
<h2 id="714-synchronizationsynchronized">7.14 <a href="https://docs.oracle.com/javase/specs/jvms/se6/html/Compiling.doc.html#6530">Synchronization</a></h2>
<p>The Java virtual machine provides explicit support for synchronization through its monitorenter and monitorexit instructions. For code written in the Java programming language, however, perhaps the most common form of synchronization is the synchronized method.</p>
<p>Jvm é€šè¿‡ <em>monitorenter</em> å’Œ <em>monitorexit</em> æŒ‡ä»¤ä¸ºåŒæ­¥æ“ä½œæä¾›æ”¯æŒã€‚ä½†å¯¹äº Java ç¼–å†™çš„ä»£ç ï¼Œæœ€å¸¸è§çš„åŒæ­¥å½¢å¼å¯èƒ½æ˜¯ <em>synchronized</em> æ–¹æ³•ã€‚</p>
<p>A synchronized method is not normally implemented using monitorenter and monitorexit. Rather, it is simply distinguished in the runtime constant pool by the ACC_SYNCHRONIZED flag, which is checked by the method invocation instructions. When invoking a method for which ACC_SYNCHRONIZED is set, the current thread acquires a monitor, invokes the method itself, and releases the monitor whether the method invocation completes normally or abruptly. During the time the executing thread owns the monitor, no other thread may acquire it. If an exception is thrown during invocation of the synchronized method and the synchronized method does not handle the exception, the monitor for the method is automatically released before the exception is rethrown out of the synchronized method.</p>
<p>Jvm é€šå¸¸ä¸ä½¿ç”¨ <em>monitorenter</em> å’Œ <em>monitorexit</em> å®ç°åŒæ­¥æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶å¸¸é‡æ± é€šè¿‡ <em>ACC_SYNCHRONIZED</em> æ ‡è®°åŠ ä»¥åŒºåˆ†ï¼Œè¯¥æ ‡è®°ç”±æ–¹æ³•è°ƒç”¨æŒ‡ä»¤æ ¡éªŒã€‚å½“è°ƒç”¨æ ‡è®°ä¸º <em>ACC_SYNCHRONIZED</em> çš„æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹è·å– monitorï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•è‡ªèº«ï¼Œå¹¶é‡Šæ”¾ monitorï¼Œä¸ç®¡æ–¹æ³•è°ƒç”¨æ˜¯æ­£å¸¸å®Œæˆæˆ–çªç„¶ä¸­æ–­ã€‚</p>
<p>æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ‹¥æœ‰ monitor æ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ— æ³•è·å–å®ƒã€‚å¦‚æœåœ¨è°ƒç”¨åŒæ­¥æ–¹æ³•æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œä¸”åŒæ­¥æ–¹æ³•æ— æ³•å¤„ç†è¯¥å¼‚å¸¸ï¼Œåˆ™åœ¨å¼‚å¸¸ä»åŒæ­¥æ–¹æ³•æŠ›å‡ºæ‰§è¡Œï¼Œè‡ªåŠ¨é‡Šæ”¾è¯¥æ–¹æ³•çš„ monitor.</p>
<p>The <em>monitorenter</em> and <em>monitorexit</em> instructions exist to support synchronized statements. For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onlyMe</span><span style="color:#f92672">(</span>Foo f<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">synchronized</span><span style="color:#f92672">(</span>f<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        doSomething<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>is compiled to</p>
<pre><code class="language-assembly" data-lang="assembly">Method void onlyMe(Foo)
   0 	aload_1				// Push f	
   1 	astore_2			// Store it in local variable 2
   2 	aload_2				// Push local variable 2 (f)
   3 	monitorenter		// Enter the monitor associated with f
   4 	aload_0				// Holding the monitor, pass this and...
   5 	invokevirtual #5 	// ...call Example.doSomething()V
   8	aload_2				// Push local variable 2 (f)
   9	monitorexit			// Exit the monitor associated with f
  10	return				// Return normally
  11 	aload_2				// In case of any throw, end up here
  12 	monitorexit			// Be sure to exit monitor...
  13 	athrow				// ...then rethrow the value to the invoker
Exception table:
   	From	To 	Target 		Type
    4     	8   11   		any
</code></pre><h2 id="volatile">Volatile</h2>
<p>The rules for volatile variables effectively require that main memory be touched exactly once for each use or assign of a volatile variable by a thread, and that main memory be touched in exactly the order dictated by the thread execution semantics. However, such memory operations are not ordered with respect to read and write operations on nonvolatile variables.</p>
<h2 id="thread-pool">Thread Pool</h2>
<p>Most of the executor implementations in <em>java.util.concurrent</em> use thread pools, which consist of <em>worker threads</em>. This kind of thread exists separately from the <em>Runnable</em> and <em>Callable</em> tasks it executes and is often used to execute multiple tasks.</p>
<p><em>java.util.concurrent</em> åŒ…ä¸­å¤§éƒ¨åˆ† executor å®ç°éƒ½ä½¿ç”¨çº¿ç¨‹æ± ï¼Œè¿™äº›çº¿ç¨‹æ± ç”± <em>work threads</em> ç»„æˆã€‚è¿™äº›çº¿ç¨‹ä¸å®ƒæ‰§è¡Œçš„ <em>Runnable</em> å’Œ <em>Callable</em> ä»»åŠ¡åˆ†å¼€ï¼Œé€šå¸¸ç”¨äºæ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚</p>
<p>Using <em>worker threads</em> minimizes the overhead due to thread creation. Thread objects use a significant amount of memory, and in a large-scale application, allocating and deallocating many thread objects creates a significant memory management overhead.</p>
<p>ä½¿ç”¨ <em>worker threads</em> å¯ä»¥æœ€å¤§é™åº¦å‡å°‘çº¿ç¨‹åˆ›å»ºæ‰€å¸¦æ¥çš„å¼€é”€ã€‚çº¿ç¨‹å¯¹è±¡å ç”¨å¤§é‡å†…å­˜ï¼Œå¹¶ä¸”åœ¨å¤§è§„æ¨¡ App ä¸­ï¼Œåˆ†é…å’Œå–æ¶ˆåˆ†é…è®¸å¤šçº¿ç¨‹ä¼šäº§ç”Ÿå¤§é‡å†…å­˜ç®¡ç†çš„å¼€é”€ã€‚</p>
<p>One common type of thread pool is the <em>fixed thread pool</em>. This type of pool always has a specified number of threads running; if a thread is somehow terminated while it is still in use, it is automatically replaced with a new thread. Tasks are submitted to the pool via an <em>internal queue</em>, which holds extra tasks whenever there are more active tasks than threads.</p>
<p>çº¿ç¨‹æ± çš„ä¸€ç§å¸¸è§ç±»å‹æ˜¯ <em>fixed thread pool</em>ã€‚è¿™ç§ç±»å‹çš„çº¿ç¨‹æ± å§‹ç»ˆæœ‰æŒ‡å®šæ•°é‡çš„çº¿ç¨‹åœ¨è¿è¡Œï¼›å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨ä½¿ç”¨æ—¶è¢«æŸç§æ–¹å¼çªç„¶ç»ˆæ­¢ï¼Œåˆ™çº¿ç¨‹æ± ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ›¿æ¢ç»ˆæ­¢çš„çº¿ç¨‹ã€‚ä»»åŠ¡é€šè¿‡å†…éƒ¨é˜Ÿåˆ—æäº¤åˆ°çº¿ç¨‹æ± ä¸­ï¼Œ<em>è¯¥å†…éƒ¨é˜Ÿåˆ—åœ¨æ´»åŠ¨ä»»åŠ¡å¤šäºçº¿ç¨‹æ•°æ—¶å®¹çº³é¢å¤–çš„ä»»åŠ¡ã€‚</em></p>
<p>An important advantage of the fixed thread pool is that applications using it degrade gracefully. To understand this, consider a web server application where each HTTP request is handled by a separate thread. If the application simply creates a new thread for every new HTTP request, and the system receives more requests than it can handle immediately, the application will suddenly stop responding to all requests when the overhead of all those threads exceed the capacity of the system. With a limit on the number of the threads that can be created, the application will not be servicing HTTP requests as quickly as they come in, but it will be servicing them as quickly as the system can sustain.</p>
<p>å›ºå®šçº¿ç¨‹æ± çš„ä¸€ä¸ªé‡è¦ä¼˜åŠ¿æ˜¯ä½¿ç”¨è¯¥çº¿ç¨‹æ± çš„ App å¯ä»¥æ­£å¸¸é™çº§ã€‚è€ƒè™‘ä¸€ä¸ª Web æœåŠ¡åº”ç”¨ï¼Œæ¯ä¸ª HTTP è¯·æ±‚å‡ç”±å•ç‹¬çš„çº¿ç¨‹å¤„ç†ã€‚å¦‚æœè¯¥åº”ç”¨ä»…ç®€å•é’ˆå¯¹æ¯ä¸ª HTTP è¯·æ±‚åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œ
å¹¶ä¸”ç³»ç»Ÿæ”¶åˆ°çš„è¯·æ±‚è¶…å‡ºäº†å…¶ç«‹å³å¤„ç†çš„æ•°é‡ï¼Œå½“è¿™äº›çº¿ç¨‹çš„æ‰€æœ‰å¼€é”€è¶…å‡ºç³»ç»Ÿçš„å®¹é‡æ—¶ï¼Œåº”ç”¨ä¼šçªç„¶åœæ­¢å“åº”æ‰€æœ‰è¯·æ±‚ã€‚ç”±äºå¯ä»¥åˆ›å»ºçš„çº¿ç¨‹æ•°é‡å—åˆ°é™åˆ¶ï¼Œå› æ­¤åº”ç”¨å¯ä»¥ä¸å°½å¿«çš„å¤„ç† HTTP è¯·æ±‚ï¼Œä½†
å¯ä»¥æ ¹æ®ç³»ç»Ÿèƒ½åŠ›å°½å¿«æœåŠ¡è¿™äº›è¯·æ±‚ã€‚</p>
<p>A simple way to create an executor that uses a fixed thread pool is to invoke the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executors.html#newFixedThreadPool-int-">newFixedThreadPool</a> factory method in <em>java.util.concurrent.Executors</em> This class also provides the following factory methods:</p>
<p>è°ƒç”¨ <em>java.util.concurrent.Executors</em> ä¸­çš„ newFixedThreadPool å·¥å‚æ–¹æ³•å¯ä»¥åˆ›å»ºå›ºå®šçº¿ç¨‹æ± çš„ executorã€‚æ­¤ç±»è¿˜æä¾›å¦‚ä¸‹å·¥å‚æ–¹æ³•ï¼š</p>
<ul>
<li>
<p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executors.html#newCachedThreadPool-int-">newCachedThreadPool</a> method creates an executor with an expandable thread pool. This executor is suitable for applications that launch many short-lived tasks.</p>
<p><em>newCachedThreadPool</em> ä½¿ç”¨å¯æ‰©å±•çš„çº¿ç¨‹æ± åˆ›å»º executorã€‚æ­¤ç±»çº¿ç¨‹æ± é€‚ç”¨äºå¯åŠ¨è®¸å¤šçŸ­æœŸä»»åŠ¡çš„åº”ç”¨ç¨‹åºã€‚</p>
</li>
<li>
<p>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executors.html#newSingleThreadExecutor-int-">newSingleThreadExecutor</a> method creates an executor that executes a single task at a time.</p>
<p><em>newSingleThreadExecutor</em> åˆ›å»ºçš„ executor æ¯æ¬¡åªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚</p>
</li>
<li>
<p>Several factory methods are <em>ScheduledExecutorService</em> versions of the above executors.</p>
<p>ä¸Šè¿° executor çš„ <em>ScheduledExecutorService</em> ç‰ˆæœ¬æœ‰å‡ ç§å·¥å‚æ–¹æ³•ã€‚</p>
</li>
</ul>
<p>If none of the executors provided by the above factory methods meet your needs, constructing instances of <em>java.util.concurrent.ThreadPoolExecutor</em> or <em>java.util.concurrent.ScheduledThreadPoolExecutor</em> will give you additional options.</p>
<p>é™¤äº†ä¸Šé¢è¿™äº›åˆ›å»º executor çš„æ–¹æ³•ï¼Œ<em>java.util.concurrent.ThreadPoolExecutor</em> å’Œ <em>java.util.concurrent.ScheduledThreadPoolExecutor</em> ä¹Ÿä¼šæä¾›é¢å¤–çš„æ–¹æ³•ã€‚</p>
<h2 id="processes-and-threads">Processes and Threads</h2>
<p>In concurrent programming, there are two basic units of execution: <em>processes</em> and <em>threads</em>. In the Java programming language, concurrent programming is mostly concerned with threads. However, processes are also important.</p>
<p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªåŸºæœ¬çš„æ‰§è¡Œå•å…ƒï¼šè¿›ç¨‹å’Œçº¿ç¨‹ã€‚Java å¹¶å‘ç¼–ç¨‹ä¸»è¦å’Œçº¿ç¨‹æœ‰å…³ï¼Œä¸è¿‡è¿›ç¨‹ä¹Ÿå¾ˆé‡è¦ã€‚</p>
<p>A computer system normally has many active processes and threads. This is true even in systems that only have a single execution core, and thus only have one thread actually executing at any given moment. Processing time for a single core is shared among processes and threads through an OS feature called <em>time slicing</em>.</p>
<p>è®¡ç®—æœºç³»ç»Ÿé€šå¸¸æœ‰å¾ˆå¤šæ´»è·ƒçš„è¿›ç¨‹å’Œçº¿ç¨‹ã€‚è¿™åœ¨åªæœ‰ä¸€ä¸ªæ‰§è¡Œæ ¸å¿ƒä»¥è‡³äºä»»ä½•æ—¶åˆ»éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹å®é™…æ‰§è¡Œçš„ç³»ç»Ÿä¹Ÿæ˜¯å¦‚æ­¤ã€‚é€šè¿‡ç§°ä¸º <em>æ—¶é—´åˆ†ç‰‡</em> çš„ OS åŠŸèƒ½ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹å¯ä»¥å…±äº«å•ä¸ªå†…æ ¸çš„å¤„ç†æ—¶é—´ã€‚</p>
<p>It&rsquo;s becoming more and more common for computer systems to have multiple processors or processors with multiple execution cores. This greatly enhances a system&rsquo;s capacity for concurrent execution of processes and threads â€” but concurrency is possible even on simple systems, without multiple processors or execution cores.</p>
<p>å…·æœ‰å¤šä¸ªå¤„ç†å™¨æˆ–å¤šä¸ªæ‰§è¡Œæ ¸å¿ƒçš„å¤„ç†å™¨çš„è®¡ç®—æœºç³»ç»Ÿæ­£åœ¨å˜å¾—è¶Šæ¥è¶Šæ™®éã€‚è¿™æå¤§å¢å¼ºäº†å¹¶å‘æ‰§è¡Œå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹çš„èƒ½åŠ›â€”â€”å³ä½¿æ˜¯åœ¨æ²¡æœ‰å¤šæ ¸å¤„ç†å™¨çš„ç®€å•ç³»ç»Ÿä¸Šï¼Œå¹¶å‘ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚</p>
<h3 id="processes">Processes</h3>
<p>A process has a self-contained execution environment. A process generally has a complete, private set of basic run-time resources; in particular, each process has its own memory space.</p>
<p>è¿›ç¨‹å…·æœ‰ç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒã€‚è¿›ç¨‹é€šå¸¸å…·æœ‰ä¸€ç»„å®Œæ•´çš„ã€ç§æœ‰çš„åŸºæœ¬è¿è¡Œæ—¶èµ„æºï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>Processes are often seen as synonymous with programs or applications. However, what the user sees as a single application may in fact be a set of cooperating processes. To facilitate communication between processes, most operating systems support <em>Inter Process Communication</em> (IPC) resources, such as pipes and sockets. IPC is used not just for communication between processes on the same system, but processes on different systems.</p>
<p>è¿›ç¨‹é€šå¸¸è¢«è§†ä¸ºç¨‹åºæˆ–åº”ç”¨çš„ä»£åè¯ã€‚ä½†å®é™…ä¸Šç”¨æˆ·çœ‹è§çš„å•ä¸ªåº”ç”¨å¯èƒ½ä¸€ç»„åä½œè¿›ç¨‹ã€‚ä¸ºäº†ä¿ƒè¿›è¿›ç¨‹é—´çš„é€šä¿¡ï¼Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒ <em>è¿›ç¨‹é—´é€šä¿¡</em>ï¼ˆIPCï¼‰èµ„æºï¼Œæ¯”å¦‚ç®¡é“ï¼ˆpipesï¼‰å’Œsockets. IPC ä¸ä»…å¯ä»¥ç”¨åœ¨åŒä¸€ç³»ç»Ÿçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œè¿˜å¯ç”¨äºä¸åŒç³»ç»Ÿä¸Šçš„è¿›ç¨‹ã€‚</p>
<p>Most implementations of the Java virtual machine run as a single process. A Java application can create additional processes using a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ProcessBuilder.html">ProcessBuilder</a> object. Multiprocess applications are beyond the scope of this lesson.</p>
<p>å¤§å¤šæ•°çš„ Jvm å®ç°éƒ½æ˜¯ä»¥å•ä¸ªè¿›ç¨‹è¿è¡Œçš„ã€‚Java åº”ç”¨å¯ä»¥ä½¿ç”¨ <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ProcessBuilder.html">ProcessBuilder</a> åˆ›å»ºæ–°çš„è¿›ç¨‹ï¼Œä¸è¿‡å¤šè¿›ç¨‹åº”ç”¨ä¸åœ¨è¿™é‡Œçš„è®¨è®ºèŒƒå›´ã€‚</p>
<h3 id="threads">Threads</h3>
<p>Threads are sometimes called <em>lightweight processes</em>. Both processes and threads provide an execution environment, but creating a new thread requires fewer resources than creating a new process.</p>
<p>çº¿ç¨‹é€šå¸¸è¢«ç§°ä¸º <em>è½»é‡çº§è¿›ç¨‹</em>ã€‚è¿›ç¨‹å’Œçº¿ç¨‹éƒ½å¯ä»¥æä¾›æ‰§è¡Œç¯å¢ƒï¼Œä½†åˆ›å»ºçº¿ç¨‹è¦æ¯”åˆ›å»ºè¿›ç¨‹éœ€è¦æ›´å°‘çš„èµ„æºã€‚</p>
<p>Threads exist within a process â€” every process has at least one. Threads share the process&rsquo;s resources, including memory and open files. This makes for efficient, but potentially problematic, communication.</p>
<p>çº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹ä¸­ â€”â€” æ¯ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªã€‚çº¿ç¨‹åˆ†äº«è¿›ç¨‹èµ„æºï¼ŒåŒ…æ‹¬å†…å­˜å’Œæ‰“å¼€çš„æ–‡ä»¶ã€‚è¿™æ ·å¯ä»¥è¿›è¡Œé«˜æ•ˆçš„ã€ä½†åŒæ—¶åˆå¯èƒ½æœ‰é—®é¢˜çš„é€šä¿¡ã€‚</p>
<p>Multithreaded execution is an essential feature of the Java platform. Every application has at least one thread â€” or several, if you count &ldquo;system&rdquo; threads that do things like memory management and signal handling. But from the application programmer&rsquo;s point of view, you start with just one thread, called the main thread. This thread has the ability to create additional threads, as we&rsquo;ll demonstrate in the next section.</p>
<p>å¤šçº¿ç¨‹æ‰§è¡Œæ˜¯ Java å¹³å°åŸºç¡€çš„åŠŸèƒ½ã€‚æ¯ä¸ªåº”ç”¨è‡³å°‘æœ‰ä¸€ä¸ª â€”â€” å¦‚æœç®—ä¸Šæ‰§è¡Œå†…å­˜ç®¡ç†å’Œä¿¡å·å¤„ç†çš„ç³»ç»Ÿçº¿ç¨‹ï¼Œåˆ™æœ‰å¤šä¸ªã€‚ä½†ä»åº”ç”¨ç¨‹åºå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªçº¿ç¨‹å¼€å§‹ï¼Œç§°ä¸º<em>ä¸»çº¿ç¨‹ï¼ˆmain threadï¼‰</em>ï¼Œè¿™ä¸ªçº¿ç¨‹æœ‰èƒ½åŠ›åˆ›å»ºåˆ«çš„çº¿ç¨‹ã€‚</p>
<h4 id="thread-objects">Thread Objects</h4>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½ä¸ä¸€ä¸ª <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html">Thread</a> ç›¸å…³ã€‚æœ‰ä¸¤ç§ç­–ç•¥ä½¿ç”¨ <em>Thread</em> å¯¹è±¡åˆ›å»ºå¹¶å‘åº”ç”¨ã€‚</p>
<ul>
<li>ç›´æ¥æ§åˆ¶çº¿ç¨‹çš„åˆ›å»ºå’Œç®¡ç†ï¼Œæ¯æ¬¡åº”ç”¨éœ€è¦å¯åŠ¨å¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œåªéœ€å®ä¾‹åŒ– <em>Thread</em>ã€‚</li>
<li>è¦ä»åº”ç”¨çš„å…¶ä»–éƒ¨åˆ†æŠ½è±¡çº¿ç¨‹ç®¡ç†ï¼Œå°†åº”ç”¨çš„ä»»åŠ¡ä¼ é€’ç»™ <em>executor</em>ã€‚</li>
</ul>
        </section>
        <footer>
            <a class="permalink u-url" href="https://zacash.cn/post/threads-and-locks/">ğŸ”—</a>
            
            <hr class="post-underline">
            <p class="post-tag">Tags for this post:
                
                <a href="https://zacash.cn/tags/thread" class="post-tag p-category">thread</a>
                
                <a href="https://zacash.cn/tags/lock" class="post-tag p-category">lock</a>
                
            </p>
            
        </footer>
    </article>
</div>

    
    <div class="h-card">
      <img class="u-photo" src="https://zacash.cn/images/android-os.png" />
      <div class="card-content">
        <h2 class="card-name"><a class="p-name u-url" href="https://zacash.cn" rel="me">Zac</a></h2>
        <p class="card-subhead">
          <span class="p-locality">Shanghai</span>,
          <span class="p-country-name">China</span><br />
          <a class="u-email" href="mailto:zac_ju@163.com">Email me</a>
        </p>
      </div>
      <p class="p-note">ğŸ­</p>
    </div>
    
    <div id="footer">
      
      <nav id="article-skip">
        <div class="next">
          
          <a alt="Newer article" href="https://zacash.cn/post/use-hilt-in-android/">&larr; Newer</a>
          
        </div>
        <div class="top">
          <a alt="Top of page" href="#">Top</a>
        </div>
        <div class="prev">
          
          <a alt="Older article" href="https://zacash.cn/post/websocket-and-long-polling/">Older &rarr;</a>
          
        </div>
      </nav>
      
      <aside id="social">
  <div id="social-icons">
    
    
    
    
    <div class="icon-24x24">
      <a class="glyph" alt="GitHub profile" href="https://github.com/zac4j"><img src=https://zacash.cn/icons/github.svg height="24px" width="24px"></a>
    </div>
    
    
    
    
    
    
    
    
    
    
    
    
  </div>
</aside>

      
      <p class="copyright">
          Copyright Â© 2020, Copyright Zac
      </p>
      
    </div>


</body>
</html>